<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Essens- & Wohlbefinden-Tracker</title>
<style>
  body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background-color: #0d0d0d;
    color: #e6e6e6;
    margin: 0; padding: 20px;
  }
  h1 { text-align: center; color: #5aa0ff; }
  form { display: flex; flex-direction: column; gap: 12px; max-width: 600px; margin: auto; }
  label { font-weight: 500; }
  input, select, textarea, button {
    border-radius: 10px;
    border: none;
    padding: 10px;
    font-size: 16px;
  }
  input, select, textarea {
    background-color: #1c1c1e;
    color: #fff;
  }
  button {
    background-color: #5aa0ff;
    color: white;
    cursor: pointer;
    transition: 0.3s;
  }
  button:hover { background-color: #3d7ce0; }
  #entriesModal {
    position: fixed; top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(0,0,0,0.8); display: none; justify-content: center; align-items: center;
  }
  #entriesContent {
    background: #1c1c1e; padding: 20px; border-radius: 12px; width: 90%; max-width: 700px; max-height: 80vh; overflow-y: auto;
  }
  .entry { border-bottom: 1px solid #333; margin-bottom: 10px; padding-bottom: 10px; }
  .entry button { background-color: #333; margin-left: 5px; }
  .entry button:hover { background-color: #444; }
</style>
</head>
<body>
<h1>Essens- & Wohlbefinden-Tracker</h1>
<form id="trackerForm">
  <label>Was gegessen?</label>
  <textarea id="food" rows="2"></textarea>

  <label>Stärke der Blähungen (1 = keine, 5 = stark)</label>
  <select id="bloated">
    <option value="">–</option>
    <option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
  </select>

  <label>Stuhlgang (Bristol 1–7: 1=sehr fest, 7=flüssig)</label>
  <select id="bristol">
    <option value="">–</option>
    <option>1</option><option>2</option><option>3</option><option>4</option>
    <option>5</option><option>6</option><option>7</option>
  </select>

  <label>Schlafdauer (Stunden, Komma erlaubt)</label>
  <input type="number" id="sleepDuration" step="0.1" min="0">

  <label>Schlafqualität (1–5)</label>
  <select id="sleepQuality">
    <option value="">–</option>
    <option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
  </select>

  <label>Stresslevel</label>
  <select id="stress">
    <option value="">–</option>
    <option>Niedrig</option>
    <option>Mittel</option>
    <option>Hoch</option>
  </select>

  <label>Bewegung</label>
  <select id="exercise">
    <option value="">–</option>
    <option>Keine</option>
    <option>Leicht</option>
    <option>Mittel</option>
    <option>Intensiv</option>
  </select>

  <label>Freitext</label>
  <textarea id="notes" rows="2"></textarea>

  <button type="button" onclick="saveEntry()">Eintrag speichern</button>
  <button type="button" onclick="exportEntries()">Exportieren</button>
  <button type="button" onclick="showEntries()">Alle Einträge anzeigen</button>
</form>

<div id="entriesModal" onclick="closeModal(event)">
  <div id="entriesContent" onclick="event.stopPropagation()"></div>
</div>

<script>
let entries = JSON.parse(localStorage.getItem('entries') || '[]');
let lastBackup = localStorage.getItem('lastBackupDate');

function saveEntry() {
  const entry = {
    date: new Date().toLocaleString(),
    food: food.value,
    bloated: bloated.value,
    bristol: bristol.value,
    sleepDuration: sleepDuration.value,
    sleepQuality: sleepQuality.value,
    stress: stress.value,
    exercise: exercise.value,
    notes: notes.value
  };
  entries.push(entry);
  localStorage.setItem('entries', JSON.stringify(entries));
  alert('Eintrag gespeichert!');

  // Weekly backup check
  const now = new Date();
  if (!lastBackup || (now - new Date(lastBackup)) / (1000*60*60*24) >= 7) {
    if (confirm('Möchtest du deine Einträge der letzten Woche sichern?')) {
      exportEntries(true);
      localStorage.setItem('lastBackupDate', now.toISOString());
      lastBackup = now.toISOString();
    }
  }
  document.getElementById('trackerForm').reset();
}

function exportEntries(auto = false) {
  const start = new Date();
  const end = new Date();
  const filename = `entries_${new Date(start.getTime() - 7*24*60*60*1000).toISOString().split('T')[0]}_bis_${end.toISOString().split('T')[0]}.json`;
  const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(entries, null, 2));
  const dlAnchor = document.createElement('a');
  dlAnchor.setAttribute("href", dataStr);
  dlAnchor.setAttribute("download", filename);
  dlAnchor.click();
  if (!auto) alert('Daten exportiert!');
}

function showEntries() {
  const modal = document.getElementById('entriesModal');
  const content = document.getElementById('entriesContent');
  content.innerHTML = '';
  entries.forEach((e, i) => {
    const div = document.createElement('div');
    div.className = 'entry';
    div.innerHTML = `<strong>${e.date}</strong><br>
      Essen: ${e.food || '-'}<br>
      Blähungen: ${e.bloated || '-'}<br>
      Bristol: ${e.bristol || '-'}<br>
      Schlaf: ${e.sleepDuration || '-'} Std, Qualität: ${e.sleepQuality || '-'}<br>
      Stress: ${e.stress || '-'}, Bewegung: ${e.exercise || '-'}<br>
      Notiz: ${e.notes || '-'}<br>
      <button onclick='editEntry(${i})'>Bearbeiten</button>
      <button onclick='deleteEntry(${i})'>Löschen</button>`;
    content.appendChild(div);
  });
  modal.style.display = 'flex';
}

function closeModal(e) {
  document.getElementById('entriesModal').style.display = 'none';
}

function deleteEntry(index) {
  if (confirm('Eintrag wirklich löschen?')) {
    entries.splice(index, 1);
    localStorage.setItem('entries', JSON.stringify(entries));
    showEntries();
  }
}

function editEntry(index) {
  const e = entries[index];
  document.getElementById('food').value = e.food;
  document.getElementById('bloated').value = e.bloated;
  document.getElementById('bristol').value = e.bristol;
  document.getElementById('sleepDuration').value = e.sleepDuration;
  document.getElementById('sleepQuality').value = e.sleepQuality;
  document.getElementById('stress').value = e.stress;
  document.getElementById('exercise').value = e.exercise;
  document.getElementById('notes').value = e.notes;
  entries.splice(index, 1);
  localStorage.setItem('entries', JSON.stringify(entries));
  document.getElementById('entriesModal').style.display = 'none';
}
</script>
</body>
</html>
